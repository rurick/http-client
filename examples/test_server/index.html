<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP Client Test Server</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .server-info {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 25px;
            border-left: 4px solid #007bff;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:active {
            transform: translateY(1px);
        }
        .response {
            margin-top: 25px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #007bff;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            border-left-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        .success {
            border-left-color: #28a745;
            background-color: #d4edda;
            color: #155724;
        }
        .endpoints {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 4px;
            margin-top: 30px;
        }
        .endpoints h2 {
            margin-top: 0;
            color: #333;
        }
        .endpoints ul {
            list-style-type: none;
            padding: 0;
        }
        .endpoints li {
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        .endpoints li:last-child {
            border-bottom: none;
        }
        .endpoint-method {
            background-color: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-right: 10px;
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üöÄ HTTP Client Test Server</h1>

    <div class="server-info">
        <strong>–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É {{.Port}}</strong><br>
        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º—É –Ω–∏–∂–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ API –Ω–∞–ø—Ä—è–º—É—é.
    </div>

    <form id="testForm">
        <div class="form-group">
            <label for="method">HTTP –º–µ—Ç–æ–¥:</label>
            <select id="method" name="method">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
            </select>
        </div>

        <div class="form-group">
            <label for="endpoint">Endpoint:</label>
            <input type="text" id="endpoint" name="endpoint" value="/api/test" placeholder="/api/test">
        </div>

        <div class="form-group">
            <label for="message">–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
            <input type="text" id="message" name="message" placeholder="–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" value="–ü—Ä–∏–≤–µ—Ç –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞!">
        </div>

        <div class="form-group">
            <label for="data">JSON –¥–∞–Ω–Ω—ã–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
            <textarea id="data" name="data" rows="4" placeholder='{"key": "value", "number": 123}'>{"user_id": 1, "action": "test"}</textarea>
        </div>

        <button type="submit" id="submitBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å</button>
    </form>

    <div id="response" class="response" style="display: none;"></div>

    <div class="endpoints">
        <h2>üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ endpoints:</h2>
        <ul>
            <li><span class="endpoint-method">GET/POST</span><strong>/api/test</strong> - –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</li>
            <li><span class="endpoint-method">GET</span><strong>/api/echo</strong> - –≠—Ö–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞</li>
            <li><span class="endpoint-method">GET</span><strong>/api/status</strong> - –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏ HTTP –∫–ª–∏–µ–Ω—Ç–∞</li>
            <li><span class="endpoint-method">GET</span><strong>/metrics</strong> - –ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus</li>
        </ul>
    </div>
</div>

<script>
    document.getElementById('testForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const submitBtn = document.getElementById('submitBtn');
        const responseDiv = document.getElementById('response');
        const form = document.getElementById('testForm');

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
        submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è...';
        submitBtn.disabled = true;
        form.classList.add('loading');

        const formData = new FormData(e.target);
        const method = formData.get('method');
        const endpoint = formData.get('endpoint');
        const message = formData.get('message');
        const dataStr = formData.get('data');

        let requestBody = { message: message };
        if (dataStr.trim()) {
            try {
                requestBody.data = JSON.parse(dataStr);
            } catch (err) {
                showResponse('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ' + err.message, 'error');
                resetForm();
                return;
            }
        }

        try {
            const options = {
                method: method,
                headers: { 'Content-Type': 'application/json' }
            };

            if (method === 'POST') {
                options.body = JSON.stringify(requestBody);
            }

            const startTime = Date.now();
            const response = await fetch(endpoint, options);
            const endTime = Date.now();
            const duration = endTime - startTime;

            const result = await response.json();

            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–ø—Ä–æ—Å–µ
            const responseText = JSON.stringify({
                request: {
                    method: method,
                    endpoint: endpoint,
                    duration_ms: duration,
                    status: response.status
                },
                response: result
            }, null, 2);

            showResponse('‚úÖ –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω –∑–∞ ' + duration + '–º—Å:\n\n' + responseText,
                response.ok ? 'success' : 'error');
        } catch (err) {
            showResponse('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + err.message, 'error');
        } finally {
            resetForm();
        }
    });

    function showResponse(text, type) {
        const responseDiv = document.getElementById('response');
        responseDiv.textContent = text;
        responseDiv.className = 'response ' + type;
        responseDiv.style.display = 'block';
        responseDiv.scrollIntoView({ behavior: 'smooth' });
    }

    function resetForm() {
        const submitBtn = document.getElementById('submitBtn');
        const form = document.getElementById('testForm');

        submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å';
        submitBtn.disabled = false;
        form.classList.remove('loading');
    }

    // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö endpoints
    document.getElementById('endpoint').addEventListener('change', function() {
        const endpoint = this.value;
        const messageField = document.getElementById('message');
        const dataField = document.getElementById('data');

        switch(endpoint) {
            case '/api/echo':
                messageField.value = '–≠—Ö–æ —Ç–µ—Å—Ç';
                dataField.value = '{"param1": "value1", "param2": "value2"}';
                break;
            case '/api/status':
                messageField.value = '–°—Ç–∞—Ç—É—Å –∑–∞–ø—Ä–æ—Å';
                dataField.value = '{}';
                break;
            default:
                messageField.value = '–ü—Ä–∏–≤–µ—Ç –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞!';
                dataField.value = '{"user_id": 1, "action": "test"}';
        }
    });
</script>
</body>
</html>